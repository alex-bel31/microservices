# Задача 1: API Gateway

| Решение              | Маршрутизация                                              | Аутентификация                     | HTTPS терминация | Масштабируемость                              | Простота эксплуатации                                   | Доп. возможности                                 |
| -------------------- | ---------------------------------------------------------- | --------------------------------------------------------------- | ---------------- | --------------------------------------------- | ------------------------------------------------------- | ------------------------------------------------ |
| **NGINX** | Отличная, гибкая (URI, хосты, заголовки)                   | Только через lua-модули или сторонние модули (в OSS ограничено) | Да               | Высокая                                       | Простая конфигурация, но ручная                         | WAF, rate limiting (в Plus)                      |
| **Kong Gateway**     | Встроенная маршрутизация по правилам                       | Поддержка OAuth2, JWT, Keycloak, LDAP и плагинов                | Да               | Горизонтальное масштабирование, поддержка K8s | Простая (через declarative config или Admin API)        | Огромное число плагинов, сервис-меш интеграция   |
| **Traefik**          | Динамическая маршрутизация (в т.ч. для Kubernetes, Docker) | JWT, OAuth2, OIDC (middleware)                                  | Да               | Отличная в K8s, auto-discovery сервисов       | Простота и быстрая настройка                            | ACME/Let’s Encrypt, интеграция с Consul, Etcd    |
| **HAProxy**          | Очень высокая производительность маршрутизации             | Ограниченно, нужно интегрировать внешние решения                | Да               | Высочайшая (большие нагрузки)                 | Конфигурация несложная, но функционал по auth ограничен | В основном балансировщик, а не gateway           |
| **Envoy Proxy**      | Гибкая маршрутизация + поддержка сервис-меша (Istio)       | Есть механизмы аутентификации, интеграции с внешними системами  | Да               | Высокая, поддержка discovery                  | Сложнее в настройке                                     | Подходит для больших систем с Istio/Service Mesh |

### Выбор и обоснование

**Kong Gateway**

* Удовлетворяет всем требованиям из коробки: маршрутизация, проверка аутентификационных данных, HTTPS-терминация.
* Прост в эксплуатации, много готовых плагинов.
* Хорошо интегрируется с системами аутентификации.
* Поддерживает горизонтальное масштабирование и fault tolerance.
* Подходит именно как API Gateway, а не просто балансировщик.

# Задача 2: Брокер сообщений

| Решение                        | Кластеризация                       | Хранение сообщений                      | Производительность             | Поддержка форматов                                  | Разделение прав | Простота эксплуатации                                |
| ------------------------------ | ----------------------------------- | --------------------------------------- | ------------------------------ | --------------------------------------------------- | --------------- | ---------------------------------------------------- |
| **RabbitMQ**                   | Да (кластер, HA queues, Federation) | Да (на диск)                            | Высокая (десятки тыс. msg/s)   | JSON, XML, Protobuf, бинарные                       | ACL, vhost      | Простая настройка, удобные UI/CLI                    |
| **Apache Kafka**               | Да (кластер, ZooKeeper/KRaft)       | Да (долго хранит на диске, лог-система) | Очень высокая (миллионы msg/s) | Любые форматы (ключ-значение, Avro, JSON, Protobuf) | ACL             | Более сложная эксплуатация, требуется DevOps опыт    |
| **ActiveMQ Artemis**           | Да                                  | Да                                      | Средняя-высокая                | Поддержка JMS, STOMP, MQTT, AMQP                    | ACL             | Средняя сложность                                    |
| **NATS Streaming (JetStream)** | Да                                  | Да (JetStream)                          | Очень высокая                  | Простые форматы (JSON, protobuf)                    | ACL             | Простота, но функционал меньше, чем у Kafka/RabbitMQ |
| **Redis Streams**              | Да (Sentinel/Cluster)               | Да (persistency)                        | Очень высокая                  | JSON, строки, бинарные                              | ACL             | Простая, но скорее cache/stream, чем брокер          |

### Выбор и обоснование

**RabbitMQ**

* Подходит для большинства бизнес-сценариев интернет-магазина.
* Поддерживает кластеризацию и HA.
* Сообщения хранятся на диске до доставки.
* Достаточно высокая скорость работы для транзакционных нагрузок.
* Гибкая система прав доступа .
* Легче в эксплуатации по сравнению с Kafka, есть UI для админов и готовые операторы для Kubernetes.